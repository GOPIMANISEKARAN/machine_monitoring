<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Machine Monitoring System</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const MachineMonitoringApp = () => {
      const [machines, setMachines] = useState([]);
      const [selectedMachine, setSelectedMachine] = useState(null);
      const [inspectionData, setInspectionData] = useState({});
      const [showCamera, setShowCamera] = useState(null);
      const [showHistory, setShowHistory] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      const [showScanner, setShowScanner] = useState(false);
      const [history, setHistory] = useState([]);
      const [expandedHistory, setExpandedHistory] = useState({});
      const [showQRCode, setShowQRCode] = useState(null);
      const videoRef = useRef(null);
      const streamRef = useRef(null);
      const scannerVideoRef = useRef(null);
      const scannerStreamRef = useRef(null);

      useEffect(() => {
        initializeMachines();
        loadHistory();
        checkURLForMachineId();
      }, []);

      const checkURLForMachineId = () => {
        const params = new URLSearchParams(window.location.search);
        const machineId = params.get('machine');
        if (machineId) {
          const machine = machines.find(m => m.id === machineId);
          if (machine) {
            startInspection(machine);
          }
        }
      };

      useEffect(() => {
        if (machines.length > 0) {
          checkURLForMachineId();
        }
      }, [machines]);

      const normalizeMachine = (m) => ({
        ...m,
        dailyCheckpoints: Array.isArray(m.dailyCheckpoints) ? m.dailyCheckpoints : [],
        weeklyCheckpoints: Array.isArray(m.weeklyCheckpoints) ? m.weeklyCheckpoints : [],
        monthlyCheckpoints: Array.isArray(m.monthlyCheckpoints) ? m.monthlyCheckpoints : []
      });

      const isMonday = () => {
        return new Date().getDay() === 1;
      };

      const isFirstMondayOfMonth = () => {
        const today = new Date();
        if (today.getDay() !== 1) return false;
        const dayOfMonth = today.getDate();
        return dayOfMonth <= 7;
      };

      const getApplicableCheckpoints = (machine) => {
        const checkpoints = [...(machine.dailyCheckpoints || []).map(cp => ({ text: cp, type: 'daily' }))];
        
        if (isMonday()) {
          checkpoints.push(...(machine.weeklyCheckpoints || []).map(cp => ({ text: cp, type: 'weekly' })));
        }
        
        if (isFirstMondayOfMonth()) {
          checkpoints.push(...(machine.monthlyCheckpoints || []).map(cp => ({ text: cp, type: 'monthly' })));
        }
        
        return checkpoints;
      };

      const initializeMachines = () => {
        const stored = localStorage.getItem('machines-config');
        if (stored) {
          const parsed = JSON.parse(stored).map(normalizeMachine);
          setMachines(parsed);
          localStorage.setItem('machines-config', JSON.stringify(parsed));
        } else {
          const defaultMachines = [{
            id: "CMTB002",
            name: "Abrasive cutting machine - ATM",
            documentNumber: "02-QES-LAB-ML-005",
            dailyCheckpoints: ["Check blade condition"],
            weeklyCheckpoints: [],
            monthlyCheckpoints: []
          }];
          setMachines(defaultMachines);
          localStorage.setItem('machines-config', JSON.stringify(defaultMachines));
        }
      };

      const loadHistory = () => {
        const keys = Object.keys(localStorage).filter(key => key.startsWith('inspection:'));
        const inspections = keys
          .map(key => {
            try {
              return JSON.parse(localStorage.getItem(key));
            } catch (e) {
              return null;
            }
          })
          .filter(Boolean)
          .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        setHistory(inspections);
      };

      const saveMachinesConfig = (updatedMachines) => {
        const normalized = updatedMachines.map(normalizeMachine);
        setMachines(normalized);
        localStorage.setItem('machines-config', JSON.stringify(normalized));
      };

      const updateMachineField = (machineId, field, value) => {
        const updated = machines.map(m => 
          m.id === machineId ? { ...m, [field]: value } : m
        );
        saveMachinesConfig(updated);
      };

      const addCheckpoint = (machineId, type) => {
        const updated = machines.map(m => {
          if (m.id === machineId) {
            const checkpointField = `${type}Checkpoints`;
            const existing = Array.isArray(m[checkpointField]) ? m[checkpointField] : [];
            return {
              ...m,
              [checkpointField]: [...existing, '']
            };
          }
          return m;
        });
        saveMachinesConfig(updated);
      };

      const updateCheckpointText = (machineId, type, index, value) => {
        const updated = machines.map(m => {
          if (m.id === machineId) {
            const checkpointField = `${type}Checkpoints`;
            const existing = Array.isArray(m[checkpointField]) ? m[checkpointField] : [];
            return {
              ...m,
              [checkpointField]: existing.map((cp, i) => i === index ? value : cp)
            };
          }
          return m;
        });
        saveMachinesConfig(updated);
      };

      const deleteCheckpoint = (machineId, type, checkpointIndex) => {
        const updated = machines.map(m => {
          if (m.id === machineId) {
            const checkpointField = `${type}Checkpoints`;
            const existing = Array.isArray(m[checkpointField]) ? m[checkpointField] : [];
            return {
              ...m,
              [checkpointField]: existing.filter((_, i) => i !== checkpointIndex)
            };
          }
          return m;
        });
        saveMachinesConfig(updated);
      };

      const addNewMachine = () => {
        const newId = `M${String(machines.length + 1).padStart(3, '0')}`;
        const newMachine = {
          id: newId,
          name: `Machine ${machines.length + 1}`,
          documentNumber: `DOC-${String(machines.length + 1).padStart(3, '0')}`,
          dailyCheckpoints: ['Daily checkpoint'],
          weeklyCheckpoints: ['Weekly checkpoint'],
          monthlyCheckpoints: ['Monthly checkpoint']
        };
        saveMachinesConfig([...machines, newMachine]);
      };

      const deleteMachine = (machineId) => {
        if (confirm('Are you sure you want to delete this machine?')) {
          const updated = machines.filter(m => m.id !== machineId);
          saveMachinesConfig(updated);
        }
      };

      const generateQRCode = (machineId) => {
        setShowQRCode(machineId);
        setTimeout(() => {
          const qrContainer = document.getElementById(`qr-${machineId}`);
          if (qrContainer) {
            qrContainer.innerHTML = '';
            const url = `${window.location.origin}${window.location.pathname}?machine=${machineId}`;
            new QRCode(qrContainer, {
              text: url,
              width: 256,
              height: 256,
              colorDark: "#000000",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.H
            });
          }
        }, 100);
      };

      const downloadQRCode = (machineId) => {
        const qrContainer = document.getElementById(`qr-${machineId}`);
        const canvas = qrContainer.querySelector('canvas');
        if (canvas) {
          const machine = machines.find(m => m.id === machineId);
          const link = document.createElement('a');
          link.download = `QR-${machineId}-${machine?.name || 'machine'}.png`;
          link.href = canvas.toDataURL();
          link.click();
        }
      };

      const startScanner = async () => {
        setShowScanner(true);
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: 'environment' } 
          });
          scannerStreamRef.current = stream;
          if (scannerVideoRef.current) {
            scannerVideoRef.current.srcObject = stream;
          }
        } catch (error) {
          alert('Camera access denied. Please allow camera permissions.');
          setShowScanner(false);
        }
      };

      const stopScanner = () => {
        if (scannerStreamRef.current) {
          scannerStreamRef.current.getTracks().forEach(track => track.stop());
          scannerStreamRef.current = null;
        }
        setShowScanner(false);
      };

      const startInspection = (machine) => {
        const applicableCheckpoints = getApplicableCheckpoints(machine);
        
        setSelectedMachine(machine);
        setInspectionData({
          machineId: machine.id,
          machineName: machine.name,
          documentNumber: machine.documentNumber,
          timestamp: new Date().toISOString(),
          isMonday: isMonday(),
          isFirstMonday: isFirstMondayOfMonth(),
          checks: applicableCheckpoints.map(cp => ({
            checkpoint: cp.text,
            type: cp.type,
            status: null,
            photo: null,
            remarks: ''
          }))
        });
        setShowScanner(false);
        stopScanner();
      };

      const updateCheckpoint = (index, status) => {
        setInspectionData(prev => ({
          ...prev,
          checks: prev.checks.map((check, i) => 
            i === index ? { ...check, status } : check
          )
        }));
      };

      const startCamera = async (index) => {
        setShowCamera(index);
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: 'environment' } 
          });
          streamRef.current = stream;
          if (videoRef.current) {
            videoRef.current.srcObject = stream;
          }
        } catch (error) {
          alert('Camera access denied. Please allow camera permissions.');
          setShowCamera(null);
        }
      };

      const capturePhoto = (index) => {
        const video = videoRef.current;
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        const photoData = canvas.toDataURL('image/jpeg', 0.8);
        
        setInspectionData(prev => ({
          ...prev,
          checks: prev.checks.map((check, i) => 
            i === index ? { ...check, photo: photoData } : check
          )
        }));
        
        stopCamera();
      };

      const stopCamera = () => {
        if (streamRef.current) {
          streamRef.current.getTracks().forEach(track => track.stop());
          streamRef.current = null;
        }
        setShowCamera(null);
      };

      const updateRemarks = (index, remarks) => {
        setInspectionData(prev => ({
          ...prev,
          checks: prev.checks.map((check, i) => 
            i === index ? { ...check, remarks } : check
          )
        }));
      };

      const saveInspection = () => {
        if (!inspectionData.checks.every(check => check.status !== null)) {
          alert('Please complete all checkpoints before saving.');
          return;
        }

        const key = `inspection:${inspectionData.machineId}:${Date.now()}`;
        localStorage.setItem(key, JSON.stringify(inspectionData));
        alert('Inspection saved successfully!');
        setSelectedMachine(null);
        setInspectionData({});
        loadHistory();
      };

      const exportReport = () => {
        const csv = [
          ['Machine', 'Document Number', 'Date/Time', 'Checkpoint Type', 'Checkpoint', 'Status', 'Remarks'],
          ...history.flatMap(insp => 
            insp.checks.map(check => [
              insp.machineName,
              insp.documentNumber || '-',
              new Date(insp.timestamp).toLocaleString(),
              check.type || 'daily',
              check.checkpoint,
              check.status,
              check.remarks || '-'
            ])
          )
        ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `inspection-report-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
      };

      const toggleHistoryExpand = (index) => {
        setExpandedHistory(prev => ({
          ...prev,
          [index]: !prev[index]
        }));
      };

      return (
        <div className="min-h-screen bg-gray-100">
          <nav className="bg-blue-600 text-white p-4">
            <div className="container mx-auto flex justify-between items-center">
              <h1 className="text-2xl font-bold">Machine Monitoring System</h1>
              <div className="space-x-4">
                <button 
                  onClick={() => { setShowHistory(false); setShowSettings(false); setSelectedMachine(null); setShowScanner(false); }}
                  className="px-4 py-2 bg-blue-700 hover:bg-blue-800 rounded"
                >
                  Inspections
                </button>
                <button 
                  onClick={() => { setShowHistory(true); setShowSettings(false); setSelectedMachine(null); setShowScanner(false); }}
                  className="px-4 py-2 bg-blue-700 hover:bg-blue-800 rounded"
                >
                  History
                </button>
                <button 
                  onClick={() => { setShowSettings(true); setShowHistory(false); setSelectedMachine(null); setShowScanner(false); }}
                  className="px-4 py-2 bg-blue-700 hover:bg-blue-800 rounded"
                >
                  Settings
                </button>
              </div>
            </div>
          </nav>

          <div className="container mx-auto p-6">
            {!selectedMachine && !showHistory && !showSettings && !showScanner && (
              <div>
                <div className="mb-6 flex justify-between items-center">
                  <h2 className="text-2xl font-bold">Select a Machine to Inspect</h2>
                  <button
                    onClick={startScanner}
                    className="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold flex items-center gap-2"
                  >
                    <span className="text-xl">üì±</span> Scan QR Code
                  </button>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {machines.map(machine => (
                    <div 
                      key={machine.id}
                      className="bg-white p-6 rounded-lg shadow hover:shadow-lg transition cursor-pointer"
                      onClick={() => startInspection(machine)}
                    >
                      <h3 className="text-xl font-semibold">{machine.id}</h3>
                      <p className="text-gray-600">{machine.name}</p>
                      <p className="text-sm text-gray-500 mt-2">{machine.documentNumber}</p>
                      <div className="mt-4 flex gap-2">
                        <span className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">
                          {(machine.dailyCheckpoints || []).length} Daily
                        </span>
                        <span className="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">
                          {(machine.weeklyCheckpoints || []).length} Weekly
                        </span>
                        <span className="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded">
                          {(machine.monthlyCheckpoints || []).length} Monthly
                        </span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {showScanner && (
              <div className="bg-white p-6 rounded-lg shadow">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-2xl font-bold">Scan Machine QR Code</h2>
                  <button
                    onClick={stopScanner}
                    className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                  >
                    Cancel
                  </button>
                </div>
                <div className="max-w-2xl mx-auto">
                  <video ref={scannerVideoRef} autoPlay className="w-full border rounded mb-4"></video>
                  <p className="text-center text-gray-600">
                    Position the QR code within the camera frame. Once scanned, the inspection will start automatically.
                  </p>
                  <div className="mt-6 border-t pt-6">
                    <h3 className="font-semibold mb-3">Or select a machine manually:</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                      {machines.map(machine => (
                        <button
                          key={machine.id}
                          onClick={() => startInspection(machine)}
                          className="p-3 bg-blue-50 hover:bg-blue-100 rounded text-left"
                        >
                          <div className="font-semibold">{machine.id}</div>
                          <div className="text-sm text-gray-600">{machine.name}</div>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {selectedMachine && (
              <div>
                <div className="bg-white p-6 rounded-lg shadow mb-6">
                  <button 
                    onClick={() => setSelectedMachine(null)}
                    className="mb-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
                  >
                    ‚Üê Back to Machines
                  </button>
                  <h2 className="text-2xl font-bold">{selectedMachine.name}</h2>
                  <p className="text-gray-600">{selectedMachine.id} - {selectedMachine.documentNumber}</p>
                  <p className="text-sm text-gray-500 mt-2">
                    {new Date().toLocaleDateString()} - {new Date().toLocaleTimeString()}
                  </p>
                </div>

                <div className="space-y-4">
                  {inspectionData.checks?.map((check, index) => (
                    <div key={index} className="bg-white p-6 rounded-lg shadow">
                      <div className="flex justify-between items-start mb-4">
                        <div>
                          <h3 className="text-lg font-semibold">{check.checkpoint}</h3>
                          <span className={`inline-block px-2 py-1 text-xs rounded mt-2 ${
                            check.type === 'daily' ? 'bg-blue-100 text-blue-800' :
                            check.type === 'weekly' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-purple-100 text-purple-800'
                          }`}>
                            {check.type}
                          </span>
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => updateCheckpoint(index, 'OK')}
                            className={`px-4 py-2 rounded ${
                              check.status === 'OK' 
                                ? 'bg-green-600 text-white' 
                                : 'bg-gray-200 hover:bg-green-100'
                            }`}
                          >
                            ‚úì OK
                          </button>
                          <button
                            onClick={() => updateCheckpoint(index, 'NOT OK')}
                            className={`px-4 py-2 rounded ${
                              check.status === 'NOT OK' 
                                ? 'bg-red-600 text-white' 
                                : 'bg-gray-200 hover:bg-red-100'
                            }`}
                          >
                            ‚úó NOT OK
                          </button>
                        </div>
                      </div>

                      {check.status === 'NOT OK' && (
                        <div className="mt-4 space-y-4">
                          <div>
                            <label className="block text-sm font-medium mb-2">Remarks</label>
                            <textarea
                              value={check.remarks}
                              onChange={(e) => updateRemarks(index, e.target.value)}
                              className="w-full p-2 border rounded"
                              rows="3"
                              placeholder="Enter remarks..."
                            />
                          </div>
                          <div>
                            {!check.photo && showCamera !== index && (
                              <button
                                onClick={() => startCamera(index)}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                              >
                                üì∑ Take Photo
                              </button>
                            )}
                            {showCamera === index && (
                              <div>
                                <video ref={videoRef} autoPlay className="w-full max-w-md mb-2 border rounded"></video>
                                <div className="flex gap-2">
                                  <button
                                    onClick={() => capturePhoto(index)}
                                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                                  >
                                    Capture
                                  </button>
                                  <button
                                    onClick={stopCamera}
                                    className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"
                                  >
                                    Cancel
                                  </button>
                                </div>
                              </div>
                            )}
                            {check.photo && (
                              <div>
                                <img src={check.photo} alt="Inspection" className="max-w-md border rounded mb-2" />
                                <button
                                  onClick={() => startCamera(index)}
                                  className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                                >
                                  Retake Photo
                                </button>
                              </div>
                            )}
                          </div>
                        </div>
                      )}
                    </div>
                  ))}
                </div>

                <div className="mt-6 bg-white p-6 rounded-lg shadow">
                  <button
                    onClick={saveInspection}
                    className="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
                  >
                    Save Inspection
                  </button>
                </div>
              </div>
            )}

            {showHistory && (
              <div>
                <div className="bg-white p-6 rounded-lg shadow mb-6">
                  <div className="flex justify-between items-center">
                    <h2 className="text-2xl font-bold">Inspection History</h2>
                    <button
                      onClick={exportReport}
                      className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                    >
                      Export CSV
                    </button>
                  </div>
                </div>

                <div className="space-y-4">
                  {history.map((insp, index) => (
                    <div key={index} className="bg-white p-6 rounded-lg shadow">
                      <div className="flex justify-between items-start mb-4">
                        <div>
                          <h3 className="text-xl font-semibold">{insp.machineName}</h3>
                          <p className="text-gray-600">{insp.machineId} - {insp.documentNumber}</p>
                          <p className="text-sm text-gray-500 mt-2">
                            {new Date(insp.timestamp).toLocaleString()}
                          </p>
                        </div>
                        <button
                          onClick={() => toggleHistoryExpand(index)}
                          className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                        >
                          {expandedHistory[index] ? 'Hide Details' : 'Show Details'}
                        </button>
                      </div>

                      {expandedHistory[index] && (
                        <div className="mt-4 space-y-3 border-t pt-4">
                          {insp.checks.map((check, checkIndex) => (
                            <div key={checkIndex} className="border-b pb-3">
                              <div className="flex justify-between items-start">
                                <div className="flex-1">
                                  <p className="font-medium">{check.checkpoint}</p>
                                  <span className={`inline-block px-2 py-1 text-xs rounded mt-1 ${
                                    check.type === 'daily' ? 'bg-blue-100 text-blue-800' :
                                    check.type === 'weekly' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-purple-100 text-purple-800'
                                  }`}>
                                    {check.type}
                                  </span>
                                </div>
                                <span className={`px-3 py-1 rounded font-semibold ${
                                  check.status === 'OK' 
                                    ? 'bg-green-100 text-green-800' 
                                    : 'bg-red-100 text-red-800'
                                }`}>
                                  {check.status}
                                </span>
                              </div>
                              {check.remarks && (
                                <p className="text-sm text-gray-600 mt-2">Remarks: {check.remarks}</p>
                              )}
                              {check.photo && (
                                <img src={check.photo} alt="Inspection" className="mt-2 max-w-xs border rounded" />
                              )}
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  ))}
                  {history.length === 0 && (
                    <div className="bg-white p-6 rounded-lg shadow text-center text-gray-500">
                      No inspection history available
                    </div>
                  )}
                </div>
              </div>
            )}

            {showSettings && (
              <div>
                <div className="bg-white p-6 rounded-lg shadow mb-6">
                  <h2 className="text-2xl font-bold mb-4">Machine Settings</h2>
                  <button
                    onClick={addNewMachine}
                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                  >
                    + Add New Machine
                  </button>
                </div>

                <div className="space-y-6">
                  {machines.map(machine => (
                    <div key={machine.id} className="bg-white p-6 rounded-lg shadow">
                      <div className="mb-4">
                        <label className="block text-sm font-medium mb-2">Machine ID</label>
                        <input
                          type="text"
                          value={machine.id}
                          onChange={(e) => updateMachineField(machine.id, 'id', e.target.value)}
                          className="w-full p-2 border rounded"
                        />
                      </div>
                      <div className="mb-4">
                        <label className="block text-sm font-medium mb-2">Machine Name</label>
                        <input
                          type="text"
                          value={machine.name}
                          onChange={(e) => updateMachineField(machine.id, 'name', e.target.value)}
                          className="w-full p-2 border rounded"
                        />
                      </div>
                      <div className="mb-4">
                        <label className="block text-sm font-medium mb-2">Document Number</label>
                        <input
                          type="text"
                          value={machine.documentNumber}
                          onChange={(e) => updateMachineField(machine.id, 'documentNumber', e.target.value)}
                          className="w-full p-2 border rounded"
                        />
                      </div>

                      {['daily', 'weekly', 'monthly'].map(type => {
                        const checkpoints = machine[`${type}Checkpoints`] || [];
                        return (
                          <div key={type} className="mb-4">
                            <label className="block text-sm font-medium mb-2 capitalize">
                              {type} Checkpoints
                            </label>
                            <div className="space-y-2">
                              {checkpoints.map((cp, cpIndex) => (
                                <div key={cpIndex} className="flex gap-2">
                                  <input
                                    type="text"
                                    value={cp}
                                    onChange={(e) => updateCheckpointText(machine.id, type, cpIndex, e.target.value)}
                                    className="flex-1 p-2 border rounded"
                                  />
                                  <button
                                    onClick={() => deleteCheckpoint(machine.id, type, cpIndex)}
                                    className="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                                  >
                                    Delete
                                  </button>
                                </div>
                              ))}
                              <button
                                onClick={() => addCheckpoint(machine.id, type)}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                              >
                                + Add {type} Checkpoint
                              </button>
                            </div>
                          </div>
                        );
                      })}

                      <div className="mb-4 border-t pt-4">
                        <div className="flex justify-between items-center mb-2">
                          <label className="block text-sm font-medium">QR Code for this Machine</label>
                          <button
                            onClick={() => generateQRCode(machine.id)}
                            className="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700"
                          >
                            {showQRCode === machine.id ? 'Hide QR Code' : 'Generate QR Code'}
                          </button>
                        </div>
                        {showQRCode === machine.id && (
                          <div className="mt-4 p-4 bg-gray-50 rounded text-center">
                            <div id={`qr-${machine.id}`} className="inline-block mb-4"></div>
                            <p className="text-sm text-gray-600 mb-4">
                              Scan this QR code to directly access {machine.id} inspection
                            </p>
                            <button
                              onClick={() => downloadQRCode(machine.id)}
                              className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                            >
                              Download QR Code
                            </button>
                          </div>
                        )}
                      </div>

                      <button
                        onClick={() => deleteMachine(machine.id)}
                        className="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                      >
                        Delete Machine
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<MachineMonitoringApp />, document.getElementById('root'));